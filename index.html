<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mtaani Wifi Hub | Hotspot Management</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1c1917; color: #d6d3d1; margin: 0; }
        .glass-card { background: rgba(41, 37, 36, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(120, 53, 15, 0.1); }
        .active-tab { border-bottom: 3px solid #78350f; color: #fff !important; }
        .hidden { display: none; }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1c1917; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #78350f; border-radius: 10px; }
    </style>
</head>
<body class="custom-scroll min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-[#1c1917]/90 backdrop-blur-md border-b border-[#44403c]">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-[#78350f] rounded-xl shadow-lg">
                    <i data-lucide="zap" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <span class="text-xl font-black italic tracking-tighter uppercase block leading-none">Mtaani Wifi</span>
                    <span class="text-[9px] font-bold text-[#78350f] tracking-[0.3em] uppercase">Hotspot System</span>
                </div>
            </div>
            <div class="flex gap-6">
                <button onclick="switchTab('portal')" id="nav-portal" class="text-xs font-black uppercase tracking-widest py-7 opacity-50 hover:opacity-100 transition-all">Portal</button>
                <button onclick="switchTab('admin')" id="nav-admin" class="text-xs font-black uppercase tracking-widest py-7 opacity-50 hover:opacity-100 transition-all">Admin</button>
            </div>
        </div>
    </nav>

    <main class="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8">
        
        <!-- CUSTOMER PORTAL -->
        <div id="view-portal" class="space-y-12 pb-20">
            <header class="text-center md:text-left space-y-4 pt-10">
                <h1 class="text-5xl md:text-7xl font-black uppercase tracking-tighter italic leading-[0.9]">Internet ya Kasi,<br><span class="text-[#78350f]">Bei ya Mtaani.</span></h1>
                <p class="text-[#a8a29e] text-lg max-w-xl font-medium">Chagua ofa inayokufaa uanze kutumia internet yenye kasi sasa hivi.</p>
            </header>

            <!-- Plans -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div onclick="openPayModal('Lite', 500)" class="glass-card p-10 rounded-[2.5rem] border-2 border-transparent hover:border-[#78350f] transition-all group cursor-pointer">
                    <div class="flex justify-between items-start mb-8">
                        <i data-lucide="ticket" class="w-10 h-10 text-[#78350f]"></i>
                        <span class="bg-[#78350f] text-[10px] font-black px-4 py-1 rounded-full uppercase">Saa 6</span>
                    </div>
                    <h3 class="text-3xl font-black uppercase mb-4 tracking-tight">Daily Lite</h3>
                    <div class="text-4xl font-black mb-8">Tsh 500</div>
                    <button class="w-full py-5 bg-[#44403c] group-hover:bg-[#78350f] rounded-2xl font-black uppercase text-xs tracking-widest transition-all">Nunua Sasa</button>
                </div>

                <div onclick="openPayModal('Pro', 1000)" class="glass-card p-10 rounded-[2.5rem] border-2 border-[#78350f]/50 bg-[#78350f]/5 hover:scale-[1.02] transition-all group cursor-pointer">
                    <div class="flex justify-between items-start mb-8">
                        <i data-lucide="zap" class="w-10 h-10 text-[#78350f]"></i>
                        <span class="bg-[#78350f] text-[10px] font-black px-4 py-1 rounded-full uppercase">Saa 24</span>
                    </div>
                    <h3 class="text-3xl font-black uppercase mb-4 tracking-tight">Daily Pro</h3>
                    <div class="text-4xl font-black mb-8">Tsh 1,000</div>
                    <button class="w-full py-5 bg-[#78350f] rounded-2xl font-black uppercase text-xs tracking-widest transition-all shadow-xl shadow-orange-900/20">Nunua Sasa</button>
                </div>

                <div onclick="openPayModal('Weekly', 5000)" class="glass-card p-10 rounded-[2.5rem] border-2 border-transparent hover:border-[#78350f] transition-all group cursor-pointer">
                    <div class="flex justify-between items-start mb-8">
                        <i data-lucide="shield-check" class="w-10 h-10 text-[#78350f]"></i>
                        <span class="bg-[#78350f] text-[10px] font-black px-4 py-1 rounded-full uppercase">Siku 7</span>
                    </div>
                    <h3 class="text-3xl font-black uppercase mb-4 tracking-tight">Weekly Pro</h3>
                    <div class="text-4xl font-black mb-8">Tsh 5,000</div>
                    <button class="w-full py-5 bg-[#44403c] group-hover:bg-[#78350f] rounded-2xl font-black uppercase text-xs tracking-widest transition-all">Nunua Sasa</button>
                </div>
            </div>

            <!-- Connection Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center pt-12 border-t border-[#44403c]">
                <div class="glass-card p-12 rounded-[3rem] space-y-8">
                    <h2 class="text-2xl font-black uppercase flex items-center gap-4 italic"><i data-lucide="key" class="text-[#78350f]"></i> Una Vocha Tayari?</h2>
                    <input id="voucher-input" type="text" placeholder="WEKA CODE HAPA" class="w-full bg-[#1c1917] border-2 border-[#44403c] rounded-[2rem] py-10 px-4 text-center text-4xl font-mono text-[#d6d3d1] focus:border-[#78350f] outline-none uppercase tracking-[0.3em]">
                    <button onclick="simulateConnect()" id="btn-connect" class="w-full py-6 bg-[#78350f] rounded-[2rem] font-black text-lg uppercase tracking-widest hover:bg-[#92400e] transition-all">Unganisha Sasa</button>
                </div>
                <div class="space-y-6 px-4">
                    <h3 class="text-xl font-black uppercase italic">Jinsi ya Kujiunga:</h3>
                    <ul class="space-y-4">
                        <li class="flex gap-4 text-[#a8a29e] text-sm"><span class="w-6 h-6 rounded bg-[#451a03] flex items-center justify-center text-white shrink-0 font-bold">1</span> Chagua kifurushi hapo juu.</li>
                        <li class="flex gap-4 text-[#a8a29e] text-sm"><span class="w-6 h-6 rounded bg-[#451a03] flex items-center justify-center text-white shrink-0 font-bold">2</span> Lipa kupitia namba inayojitokeza baada ya kuchagua.</li>
                        <li class="flex gap-4 text-[#a8a29e] text-sm"><span class="w-6 h-6 rounded bg-[#451a03] flex items-center justify-center text-white shrink-0 font-bold">3</span> Pokea Vocha Code yako kwa SMS kisha iweke hapa.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="view-admin" class="hidden space-y-8 animate-in fade-in duration-500 pt-10">
            <!-- Lock Screen -->
            <div id="admin-lock" class="max-w-md mx-auto glass-card p-12 rounded-[3rem] space-y-8">
                <div class="text-center">
                    <h2 class="text-2xl font-black uppercase italic">Admin Login</h2>
                    <p class="text-[10px] text-[#44403c] font-black uppercase tracking-widest">Mfumo wa Hotspot</p>
                </div>
                <input id="admin-pass" type="password" placeholder="Password" class="w-full bg-[#1c1917] border-2 border-[#44403c] p-5 rounded-2xl outline-none focus:border-[#78350f] text-center font-bold">
                <button onclick="loginAdmin()" class="w-full py-5 bg-[#78350f] rounded-2xl font-black uppercase text-xs tracking-widest">Ingia Kwenye Dashboard</button>
            </div>

            <!-- Main Admin Content -->
            <div id="admin-content" class="hidden space-y-10">
                <header class="flex justify-between items-center">
                    <div>
                        <h2 class="text-4xl font-black uppercase italic tracking-tighter leading-none">Command Center</h2>
                        <p id="ai-insight" class="text-[10px] font-mono text-[#78350f] mt-1 font-bold animate-pulse">Waiting for AI diagnosis...</p>
                    </div>
                    <button onclick="logoutAdmin()" class="p-4 bg-red-900/20 text-red-500 rounded-2xl hover:bg-red-500 hover:text-white transition-all">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </header>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="glass-card p-8 rounded-3xl border border-[#44403c]">
                        <div class="text-[10px] uppercase font-black text-[#44403c] mb-2">Revenue</div>
                        <div id="stat-revenue" class="text-2xl font-black tracking-tighter">Tsh 0</div>
                    </div>
                    <div class="glass-card p-8 rounded-3xl border border-[#44403c]">
                        <div class="text-[10px] uppercase font-black text-[#44403c] mb-2">Pending</div>
                        <div id="stat-pending" class="text-2xl font-black tracking-tighter">0</div>
                    </div>
                    <div class="glass-card p-8 rounded-3xl border border-[#44403c]">
                        <div class="text-[10px] uppercase font-black text-[#44403c] mb-2">Active Nodes</div>
                        <div class="text-2xl font-black tracking-tighter">14</div>
                    </div>
                    <div class="glass-card p-8 rounded-3xl border border-[#44403c]">
                        <div class="text-[10px] uppercase font-black text-[#44403c] mb-2">Router IP</div>
                        <div class="text-2xl font-black tracking-tighter font-mono">192.168.88.1</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 glass-card rounded-[2.5rem] overflow-hidden">
                        <div class="p-8 border-b border-[#44403c] flex justify-between items-center bg-[#1c1917]/50">
                            <h3 class="font-black uppercase text-sm">Maombi ya Vocha</h3>
                            <span class="text-[9px] font-bold bg-[#78350f] px-3 py-1 rounded-full uppercase">Real-time Sync</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead class="bg-[#1c1917]/30 text-[10px] uppercase font-black text-[#44403c]">
                                    <tr>
                                        <th class="px-8 py-5">Customer</th>
                                        <th class="px-8 py-5">Plan</th>
                                        <th class="px-8 py-5 text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="request-list" class="divide-y divide-[#44403c]/30">
                                    <!-- Dynamic Rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-card p-8 rounded-[2.5rem] space-y-6">
                        <h3 class="font-black uppercase text-sm italic border-b border-[#44403c] pb-4">MikroTik Script</h3>
                        <div class="bg-[#1c1917] p-5 rounded-2xl border border-[#44403c] font-mono text-[10px] text-[#a8a29e] overflow-x-auto leading-relaxed">
                            <pre>/ip hotspot profile
set default html-directory=mtaani
add name=mtaani_prof dns-name=mtaani.wifi

/ip dhcp-server lease
add address=192.168.88.50 mac-address=XX:XX:XX</pre>
                        </div>
                        <button onclick="copyScript()" class="w-full py-4 bg-[#44403c] hover:bg-[#78350f] rounded-xl text-[10px] font-black uppercase tracking-widest transition-all">Copy Config Script</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="modal-pay" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/95 backdrop-blur-md">
        <div class="w-full max-w-md glass-card rounded-[3rem] overflow-hidden">
            <div class="p-8 bg-[#1c1917] border-b border-[#44403c] flex justify-between items-center">
                <h3 class="font-black uppercase italic tracking-tight">Kamilisha Malipo</h3>
                <button onclick="closePayModal()" class="text-[#44403c] hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="p-10 space-y-8 text-center">
                <div class="space-y-2">
                    <p class="text-[10px] uppercase font-black text-[#44403c] tracking-widest">Tuma Tsh <span id="pay-amount">0</span> Kwenda:</p>
                    <div class="text-3xl font-black text-[#78350f] font-mono tracking-tighter">0779 231 924</div>
                    <p class="text-[10px] font-black uppercase">JAPHET SUNDAY</p>
                </div>
                <div class="space-y-4">
                    <input id="user-name" type="text" placeholder="Jina Lako la Muamala" class="w-full bg-[#1c1917] border-2 border-[#44403c] p-5 rounded-2xl outline-none focus:border-[#78350f] text-sm font-bold uppercase">
                    <input id="user-phone" type="tel" placeholder="Namba Yako ya Simu" class="w-full bg-[#1c1917] border-2 border-[#44403c] p-5 rounded-2xl outline-none focus:border-[#78350f] text-sm font-bold">
                    <button onclick="submitRequest()" class="w-full py-6 bg-[#78350f] rounded-[2rem] font-black uppercase tracking-widest hover:bg-[#92400e] transition-all">Tuma Ombi la Vocha</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP LOGIC -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@^1.38.0"
      }
    }
    </script>
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // APP STATE
        let state = {
            currentTab: 'portal',
            requests: JSON.parse(localStorage.getItem('mtaani_reqs') || '[]'),
            vouchers: JSON.parse(localStorage.getItem('mtaani_codes') || '[]'),
            isAdmin: sessionStorage.getItem('admin_logged') === 'true',
            selectedPlan: null
        };

        const save = () => {
            localStorage.setItem('mtaani_reqs', JSON.stringify(state.requests));
            localStorage.setItem('mtaani_codes', JSON.stringify(state.vouchers));
        };

        // UI HELPERS
        window.switchTab = (tab) => {
            state.currentTab = tab;
            document.getElementById('view-portal').classList.toggle('hidden', tab !== 'portal');
            document.getElementById('view-admin').classList.toggle('hidden', tab !== 'admin');
            
            document.getElementById('nav-portal').classList.toggle('active-tab', tab === 'portal');
            document.getElementById('nav-admin').classList.toggle('active-tab', tab === 'admin');

            if (tab === 'admin') renderAdmin();
        };

        window.openPayModal = (name, price) => {
            state.selectedPlan = { name, price };
            document.getElementById('pay-amount').innerText = price;
            document.getElementById('modal-pay').classList.remove('hidden');
        };

        window.closePayModal = () => {
            document.getElementById('modal-pay').classList.add('hidden');
        };

        window.submitRequest = () => {
            const name = document.getElementById('user-name').value;
            const phone = document.getElementById('user-phone').value;
            if(!name || !phone) return alert("Jaza taarifa zote!");

            const newReq = {
                id: Date.now(),
                name,
                phone,
                plan: state.selectedPlan.name,
                price: state.selectedPlan.price,
                status: 'pending'
            };

            state.requests.unshift(newReq);
            save();

            // Link kwa SMS (Hii inafanya kazi kwenye mobile vizuri)
            const body = `MTAANI WIFI: Nahitaji vocha ya ${state.selectedPlan.name} (Tsh ${state.selectedPlan.price}). Jina: ${name}, Namba: ${phone}`;
            window.location.href = `sms:0779231924?body=${encodeURIComponent(body)}`;

            alert("Ombi limetumwa! Lipia kisha utumiwe code.");
            closePayModal();
        };

        // ADMIN LOGIC
        window.loginAdmin = () => {
            const pass = document.getElementById('admin-pass').value;
            if (pass === 'mtaani') {
                state.isAdmin = true;
                sessionStorage.setItem('admin_logged', 'true');
                renderAdmin();
            } else {
                alert("Password sio sahihi!");
            }
        };

        window.logoutAdmin = () => {
            state.isAdmin = false;
            sessionStorage.removeItem('admin_logged');
            renderAdmin();
        };

        const renderAdmin = () => {
            const authDiv = document.getElementById('admin-lock');
            const dashboardDiv = document.getElementById('admin-content');
            
            if (!state.isAdmin) {
                authDiv.classList.remove('hidden');
                dashboardDiv.classList.add('hidden');
                return;
            }

            authDiv.classList.add('hidden');
            dashboardDiv.classList.remove('hidden');

            const revenue = state.requests.filter(r => r.status === 'approved').reduce((a, b) => a + b.price, 0);
            const pending = state.requests.filter(r => r.status === 'pending').length;

            document.getElementById('stat-revenue').innerText = `Tsh ${revenue.toLocaleString()}`;
            document.getElementById('stat-pending').innerText = pending;

            const list = document.getElementById('request-list');
            list.innerHTML = state.requests.length === 0 ? '<tr><td colspan="3" class="p-10 text-center opacity-30 uppercase font-black tracking-widest">Hakuna Maombi Bado</td></tr>' : '';

            state.requests.forEach(r => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-[#44403c]/10 transition-colors";
                tr.innerHTML = `
                    <td class="px-8 py-6">
                        <div class="font-black uppercase">${r.name}</div>
                        <div class="text-[10px] text-[#78350f] font-mono">${r.phone}</div>
                    </td>
                    <td class="px-8 py-6">
                        <div class="font-black uppercase">${r.plan}</div>
                        <div class="text-[10px] text-[#44403c]">Tsh ${r.price}</div>
                    </td>
                    <td class="px-8 py-6 text-center">
                        ${r.status === 'pending' ? 
                            `<button onclick="approveRequest(${r.id})" class="p-2 bg-green-900/20 text-green-500 rounded-lg hover:bg-green-500 hover:text-white transition-all"><i data-lucide="check" class="w-4 h-4"></i></button>` : 
                            `<span class="text-[8px] font-black uppercase opacity-40">${r.status}</span>`
                        }
                    </td>
                `;
                list.appendChild(tr);
            });

            lucide.createIcons();
            runAIInsight();
        };

        window.approveRequest = (id) => {
            const req = state.requests.find(r => r.id === id);
            if (!req) return;

            const code = "MT-" + Math.random().toString(36).substring(2, 8).toUpperCase();
            req.status = 'approved';
            req.voucher = code;
            
            state.vouchers.unshift({ code, plan: req.plan });
            save();

            alert(`Limeidhinishwa! Code ya mteja ni: ${code}`);
            
            // Link kwa SMS kumtumia mteja
            const body = `MTAANI WIFI: Vocha yako ya ${req.plan} ni ${code}. Karibu hewani!`;
            window.location.href = `sms:${req.phone}?body=${encodeURIComponent(body)}`;

            renderAdmin();
        };

        // GEMINI AI INSIGHT
        const runAIInsight = async () => {
            try {
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                const reqCount = state.requests.length;
                const rev = state.requests.filter(r => r.status === 'approved').reduce((a, b) => a + b.price, 0);

                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: `Kama meneja wa biashara, toa tathmini fupi sana (sentensi moja) ya biashara yenye maombi ${reqCount} na mapato ya Tsh ${rev}. Tumia lugha ya mtaani inayovutia.`,
                });
                
                document.getElementById('ai-insight').innerText = response.text || "Mfumo upo imara. Tuendelee kuhudumia mtaa!";
            } catch (e) {
                document.getElementById('ai-insight').innerText = "System online. Mambo ni moto!";
            }
        };

        window.simulateConnect = () => {
            const val = document.getElementById('voucher-input').value;
            if(!val) return alert("Weka code kwanza!");
            const btn = document.getElementById('btn-connect');
            btn.innerText = "INAHAKIKI...";
            setTimeout(() => {
                alert("IMEUNGANISHWA! Karibu Mtaani Wifi.");
                btn.innerText = "UNGANISHA SASA";
            }, 2000);
        };

        window.copyScript = () => {
            alert("Script imenakiliwa! I-paste kwenye MikroTik Terminal.");
        };

        // START APP
        lucide.createIcons();
        switchTab('portal');
    </script>
</body>
</html>