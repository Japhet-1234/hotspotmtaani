
<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mtaani Wifi - Mfumo wa Hotspot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1c1917;
            color: #d6d3d1;
            margin: 0;
            overflow-x: hidden;
        }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1c1917; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #44403c; border-radius: 10px; }
        
        .glass-card {
            background: rgba(41, 37, 36, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(68, 64, 60, 0.5);
        }
        
        .btn-amber {
            background-color: #78350f;
            color: #d6d3d1;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-amber:hover {
            background-color: #92400e;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(120, 53, 15, 0.3);
        }

        /* View Animations */
        #main-content {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@1.3.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.12.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0"
  }
}
</script>
</head>
<body class="bg-[#1c1917]">
    <!-- Root Container -->
    <div id="app-root">
        <!-- Initial Loading State -->
        <div class="h-screen w-full flex flex-col items-center justify-center gap-6">
            <div class="w-16 h-16 border-4 border-[#78350f]/20 border-t-[#78350f] rounded-full animate-spin"></div>
            <p class="text-[#78350f] font-black uppercase tracking-[0.4em] text-xs animate-pulse">Inapakia Mtaani Wifi...</p>
        </div>
    </div>

    <!-- Main Logic -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- GLOBAL STATE ---
        const state = {
            view: 'portal', // portal | dashboard | vouchers | registry | router
            isAdmin: sessionStorage.getItem('admin_auth') === 'true',
            user: JSON.parse(localStorage.getItem('mtaani_customer') || 'null'),
            plans: [
                { id: 'p1', name: 'Mtaani Lite', price: 500, duration: 'Masaa 6', desc: 'Inafaa kwa WhatsApp na browsing haraka' },
                { id: 'p2', name: 'Mtaani Daily', price: 1000, duration: 'Saa 24', desc: 'Siku nzima bila kikomo cha MB' },
                { id: 'p3', name: 'Mtaani Weekly', price: 5000, duration: 'Siku 7', desc: 'Ofa bora kwa matumizi ya familia' }
            ],
            adminPhone: "0779231924",
            paymentName: "JAPHET SUNDAY",
            adminPass: "mtaani",
            aiInsight: "Inasubiri data..."
        };

        // --- AI SERVICE ---
        async function updateAIInsight() {
            try {
                const customers = JSON.parse(localStorage.getItem('customer_registry') || '[]');
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: `Wewe ni msimamizi wa mtandao wa WiFi Tanzania. Wateja ${customers.length} wamejiunga. Toa sentensi fupi moja ya Kiswahili kuelezea hali ya mtandao.`
                });
                state.aiInsight = response.text;
                render();
            } catch (e) {
                state.aiInsight = "Mfumo uko imara (Stable). Hakuna hitilafu yoyote.";
                render();
            }
        }

        // --- UTILS ---
        function setView(v) {
            state.view = v;
            render();
            window.scrollTo(0, 0);
        }

        function toggleAdmin(pass) {
            if (pass === state.adminPass) {
                state.isAdmin = true;
                sessionStorage.setItem('admin_auth', 'true');
                setView('dashboard');
                updateAIInsight();
            } else {
                alert("Password si sahihi!");
            }
        }

        function logout() {
            state.isAdmin = false;
            sessionStorage.removeItem('admin_auth');
            setView('portal');
        }

        // --- TEMPLATES ---
        const Header = () => `
            <header class="w-full max-w-6xl mx-auto flex justify-between items-center py-8 px-6">
                <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                    <div class="p-2.5 bg-[#78350f] rounded-2xl shadow-xl shadow-[#78350f]/20">
                        <i data-lucide="zap" class="text-white w-6 h-6"></i>
                    </div>
                    <span class="text-2xl font-black italic tracking-tighter uppercase text-white">Mtaani Wifi</span>
                </div>
                <div class="flex items-center gap-4">
                    ${state.user ? `
                        <div class="hidden md:flex flex-col items-end border-r border-[#44403c] pr-4">
                            <span class="text-[9px] text-[#44403c] font-black uppercase tracking-widest">Mteja</span>
                            <span class="text-xs text-white font-bold">${state.user.name}</span>
                        </div>
                    ` : ''}
                    <button onclick="document.getElementById('admin-modal').classList.toggle('hidden')" class="p-3 bg-[#292524] rounded-2xl text-[#44403c] hover:text-[#78350f] border border-[#44403c] transition-all">
                        <i data-lucide="shield-check" class="w-6 h-6"></i>
                    </button>
                </div>
            </header>
        `;

        const Sidebar = () => `
            <aside class="w-64 border-r border-[#292524] h-screen fixed left-0 top-0 flex flex-col p-6 z-50 bg-[#1c1917]">
                <div class="flex items-center gap-3 mb-10 px-2">
                    <div class="p-2 bg-[#78350f] rounded-xl"><i data-lucide="zap" class="text-white w-5 h-5"></i></div>
                    <h1 class="text-xl font-black tracking-tighter italic text-white">MTAANI <span class="text-[#78350f] not-italic">WIFI</span></h1>
                </div>
                <nav class="flex-1 space-y-2">
                    <button onclick="setView('dashboard')" class="w-full flex items-center gap-3 px-5 py-3.5 rounded-2xl transition-all ${state.view === 'dashboard' ? 'bg-[#451a03] text-white' : 'text-[#a8a29e] hover:bg-[#292524]'}">
                        <i data-lucide="layout-dashboard" class="w-4 h-4"></i> <span class="text-sm font-bold">Dashibodi</span>
                    </button>
                    <button onclick="setView('vouchers')" class="w-full flex items-center gap-3 px-5 py-3.5 rounded-2xl transition-all ${state.view === 'vouchers' ? 'bg-[#451a03] text-white' : 'text-[#a8a29e] hover:bg-[#292524]'}">
                        <i data-lucide="ticket" class="w-4 h-4"></i> <span class="text-sm font-bold">Vocha</span>
                    </button>
                    <button onclick="setView('registry')" class="w-full flex items-center gap-3 px-5 py-3.5 rounded-2xl transition-all ${state.view === 'registry' ? 'bg-[#451a03] text-white' : 'text-[#a8a29e] hover:bg-[#292524]'}">
                        <i data-lucide="users" class="w-4 h-4"></i> <span class="text-sm font-bold">Wateja</span>
                    </button>
                    <button onclick="setView('router')" class="w-full flex items-center gap-3 px-5 py-3.5 rounded-2xl transition-all ${state.view === 'router' ? 'bg-[#451a03] text-white' : 'text-[#a8a29e] hover:bg-[#292524]'}">
                        <i data-lucide="settings" class="w-4 h-4"></i> <span class="text-sm font-bold">Router</span>
                    </button>
                </nav>
                <button onclick="logout()" class="mt-auto flex items-center gap-3 p-4 text-red-400 hover:bg-red-900/10 rounded-2xl transition-all text-xs font-black uppercase tracking-widest">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Logout
                </button>
            </aside>
        `;

        const PortalView = () => {
            return `
                <div class="min-h-screen pb-32">
                    ${Header()}
                    <main class="w-full max-w-6xl mx-auto px-6 space-y-16">
                        <section class="text-center space-y-4 pt-10">
                            <h2 class="text-5xl md:text-7xl font-black uppercase tracking-tighter italic leading-none text-white">INTERNET BILA <br/>KIKOMO MTAANI.</h2>
                            <p class="text-[#a8a29e] text-lg font-medium">Chagua kifurushi chako ufurahie kasi ya ajabu sasa hivi.</p>
                        </section>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${state.plans.map(plan => `
                                <div onclick="handleBuy('${plan.id}')" class="bg-[#292524] p-10 rounded-[3rem] border-2 border-[#44403c] hover:border-[#78350f] transition-all cursor-pointer group relative overflow-hidden">
                                    <div class="text-[10px] font-black uppercase text-[#44403c] tracking-widest group-hover:text-[#78350f] mb-4">${plan.duration}</div>
                                    <h3 class="text-3xl font-black text-white">${plan.name}</h3>
                                    <div class="text-4xl font-black text-[#78350f] my-6">Tsh ${plan.price}</div>
                                    <p class="text-sm text-[#a8a29e] font-medium leading-relaxed">${plan.desc}</p>
                                    <div class="mt-8 flex items-center gap-2 text-xs font-black uppercase text-[#78350f] group-hover:translate-x-2 transition-transform">NUNUA SASA <i data-lucide="arrow-right" class="w-4 h-4"></i></div>
                                </div>
                            `).join('')}
                        </div>

                        <section class="bg-[#292524] p-12 rounded-[4rem] border border-[#44403c] space-y-8 shadow-2xl">
                           <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                             <div class="space-y-2">
                               <h3 class="text-2xl font-black uppercase flex items-center gap-3"><i data-lucide="key" class="text-[#78350f] w-6 h-6"></i> Unganisha Vocha</h3>
                               <p class="text-[#a8a29e] text-sm">Weka code uliyopokea kwenye SMS hapa chini.</p>
                             </div>
                             <div class="flex-1 flex gap-4">
                               <input id="vcode-input" placeholder="INGIZA CODE HAPA" class="flex-1 bg-[#1c1917] border-2 border-[#44403c] rounded-[2rem] py-6 px-8 text-3xl font-black text-center tracking-[0.3em] outline-none focus:border-[#78350f] text-white uppercase"/>
                               <button onclick="alert('Checking connection...')" class="btn-amber px-10 rounded-[2rem] font-black uppercase tracking-widest shadow-xl">UNGANISHA</button>
                             </div>
                           </div>
                        </section>
                    </main>
                </div>
            `;
        };

        const DashboardView = () => {
            const requests = JSON.parse(localStorage.getItem('bundle_requests') || '[]');
            const pending = requests.filter(r => r.status === 'pending');
            const totalRev = requests.filter(r => r.status === 'approved').reduce((acc, r) => acc + r.planPrice, 0);

            return `
                <div class="p-8 space-y-8 max-w-7xl mx-auto">
                    <header>
                        <h2 class="text-4xl font-black tracking-tighter uppercase italic text-white">Admin Center</h2>
                        <p class="text-[#a8a29e] text-sm font-medium">Usimamizi wa wateja na mapato kwa Shilingi (Tsh).</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-[#292524] p-8 rounded-[2.5rem] border border-[#44403c] space-y-2">
                            <i data-lucide="banknote" class="text-[#78350f] w-8 h-8"></i>
                            <p class="text-[10px] font-black text-[#44403c] uppercase tracking-widest pt-4">Mapato Jumla</p>
                            <p class="text-3xl font-black text-white tracking-tighter">Tsh ${totalRev.toLocaleString()}</p>
                        </div>
                        <div class="bg-[#292524] p-8 rounded-[2.5rem] border border-[#44403c] space-y-2">
                            <i data-lucide="users" class="text-[#78350f] w-8 h-8"></i>
                            <p class="text-[10px] font-black text-[#44403c] uppercase tracking-widest pt-4">Wateja</p>
                            <p class="text-3xl font-black text-white tracking-tighter">${JSON.parse(localStorage.getItem('customer_registry') || '[]').length}</p>
                        </div>
                        <div class="bg-[#451a03] p-8 rounded-[2.5rem] border border-[#78350f]/30 space-y-2">
                            <i data-lucide="activity" class="text-white w-8 h-8"></i>
                            <p class="text-[10px] font-black text-white/40 uppercase tracking-widest pt-4">Status</p>
                            <p class="text-xl font-bold text-white uppercase italic">Active Online</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-[#292524] rounded-[2.5rem] border border-[#44403c] overflow-hidden">
                            <div class="p-6 border-b border-[#44403c] bg-[#1c1917]/50 flex justify-between items-center">
                                <h3 class="font-black uppercase text-xs tracking-widest text-white">Maombi Mapya</h3>
                                <span class="bg-[#78350f] px-3 py-1 rounded-full text-[9px] font-black text-white">${pending.length}</span>
                            </div>
                            <div class="p-2 h-[300px] overflow-y-auto custom-scroll">
                                ${pending.length === 0 ? '<p class="text-center py-20 text-[#44403c] uppercase font-black text-[10px]">Hakuna maombi mapya</p>' : `
                                    <div class="space-y-2">
                                        ${pending.map(req => `
                                            <div class="p-4 bg-[#1c1917] rounded-2xl flex justify-between items-center border border-transparent hover:border-[#44403c] transition-all">
                                                <div>
                                                    <div class="font-bold text-sm text-white">${req.customerName}</div>
                                                    <div class="text-[10px] text-[#78350f] font-mono">${req.planName} - Tsh ${req.planPrice}</div>
                                                </div>
                                                <button onclick="approveRequest(${req.id})" class="bg-[#78350f] p-3 rounded-xl hover:bg-[#92400e] text-white"><i data-lucide="check" class="w-4 h-4"></i></button>
                                            </div>
                                        `).join('')}
                                    </div>
                                `}
                            </div>
                        </div>
                        <div class="bg-[#292524] rounded-[2.5rem] border border-[#44403c] p-8 space-y-6">
                           <h3 class="font-black uppercase text-xs tracking-widest flex items-center gap-2 text-white"><i data-lucide="zap" class="text-[#78350f] w-4 h-4"></i> AI Insight</h3>
                           <div class="bg-[#1c1917] p-6 rounded-2xl border border-[#44403c] italic text-sm text-[#a8a29e] leading-relaxed">
                              "${state.aiInsight}"
                           </div>
                           <button onclick="location.reload()" class="w-full py-4 bg-[#78350f] rounded-xl text-[10px] font-black uppercase tracking-widest text-white">Refresh Mfumo</button>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- CORE ACTIONS ---
        window.handleBuy = (planId) => {
            const plan = state.plans.find(p => p.id === planId);
            state.selectedPlan = plan;
            if (!state.user) {
                document.getElementById('reg-modal').classList.remove('hidden');
            } else {
                document.getElementById('pay-modal').classList.remove('hidden');
                document.getElementById('pay-plan-name').innerText = plan.name;
                document.getElementById('pay-plan-price').innerText = `Tsh ${plan.price}`;
            }
        };

        window.submitReg = (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const newUser = { name, phone, id: Date.now() };
            state.user = newUser;
            localStorage.setItem('mtaani_customer', JSON.stringify(newUser));
            
            const reg = JSON.parse(localStorage.getItem('customer_registry') || '[]');
            localStorage.setItem('customer_registry', JSON.stringify([newUser, ...reg]));
            
            document.getElementById('reg-modal').classList.add('hidden');
            window.handleBuy(state.selectedPlan.id);
        };

        window.submitPayment = () => {
            const reqs = JSON.parse(localStorage.getItem('bundle_requests') || '[]');
            const newReq = {
                id: Date.now(),
                customerName: state.user.name,
                customerPhone: state.user.phone,
                planName: state.selectedPlan.name,
                planPrice: state.selectedPlan.price,
                status: 'pending'
            };
            localStorage.setItem('bundle_requests', JSON.stringify([newReq, ...reqs]));
            
            window.location.href = `sms:${state.adminPhone}?body=${encodeURIComponent(`HOTSPOT: Naitwa ${state.user.name}, nahitaji vocha ya ${state.selectedPlan.name}`)}`;
            
            document.getElementById('pay-modal').classList.add('hidden');
            alert("Ombi limetumwa! Subiri SMS ya vocha.");
        };

        window.approveRequest = (id) => {
            const reqs = JSON.parse(localStorage.getItem('bundle_requests') || '[]');
            const req = reqs.find(r => r.id === id);
            if (!req) return;

            req.status = 'approved';
            localStorage.setItem('bundle_requests', JSON.stringify(reqs));
            
            const code = `MT-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
            const msg = `Habari ${req.customerName}, Vocha yako ya ${req.planName} ni: ${code}`;
            
            window.location.href = `sms:${req.customerPhone}?body=${encodeURIComponent(msg)}`;
            render();
        };

        // --- RENDER ENGINE ---
        function render() {
            const root = document.getElementById('app-root');
            
            if (state.isAdmin && state.view !== 'portal') {
                root.innerHTML = `
                    <div class="flex min-h-screen bg-[#1c1917] text-[#d6d3d1]">
                        ${Sidebar()}
                        <main id="main-content" class="flex-1 ml-64 min-h-screen">
                            ${state.view === 'dashboard' ? DashboardView() : `
                                <div class="p-10">
                                    <h2 class="text-4xl font-black uppercase text-white">${state.view}</h2>
                                    <p class="mt-10 text-[#44403c] italic">Ukurasa huu unakamilika...</p>
                                </div>
                            `}
                        </main>
                    </div>
                `;
            } else {
                root.innerHTML = `<div id="main-content">${PortalView()}</div>`;
            }

            // Always add Modals to the end of body
            addModals();
            lucide.createIcons();
        }

        function addModals() {
            if (document.getElementById('modals-container')) return;
            const container = document.createElement('div');
            container.id = 'modals-container';
            container.innerHTML = `
                <!-- Admin Modal -->
                <div id="admin-modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-[200] backdrop-blur-xl">
                    <div class="bg-[#292524] p-12 rounded-[3rem] w-full max-w-sm border border-[#44403c] space-y-8">
                        <div class="text-center space-y-2">
                            <i data-lucide="lock" class="mx-auto text-[#78350f] w-12 h-12 mb-4"></i>
                            <h3 class="text-xl font-black uppercase text-white tracking-widest">Admin Access</h3>
                        </div>
                        <input type="password" id="admin-pass" placeholder="••••••" class="w-full bg-[#1c1917] p-6 rounded-2xl text-center text-3xl font-black outline-none border border-[#44403c] focus:border-[#78350f] text-white">
                        <button onclick="toggleAdmin(document.getElementById('admin-pass').value)" class="w-full py-6 btn-amber rounded-[2rem] font-black uppercase text-white shadow-xl">LOGIN</button>
                        <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="w-full text-[#44403c] uppercase font-black text-[10px] tracking-widest">Funga</button>
                    </div>
                </div>

                <!-- Registration Modal -->
                <div id="reg-modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-[200] backdrop-blur-md">
                    <form onsubmit="submitReg(event)" class="bg-[#292524] p-12 rounded-[3rem] w-full max-w-md border border-[#44403c] space-y-8">
                        <h3 class="text-3xl font-black uppercase text-white">Jisajili</h3>
                        <div class="space-y-4">
                            <input required id="reg-name" placeholder="Jina Lako Kamili" class="w-full bg-[#1c1917] p-6 rounded-2xl border border-[#44403c] text-white">
                            <input required id="reg-phone" type="tel" placeholder="Namba ya Simu (07...)" class="w-full bg-[#1c1917] p-6 rounded-2xl border border-[#44403c] text-white">
                        </div>
                        <button class="w-full py-6 btn-amber rounded-[2rem] font-black uppercase tracking-widest text-white shadow-xl">ENDELEA</button>
                        <button type="button" onclick="document.getElementById('reg-modal').classList.add('hidden')" class="w-full text-[#44403c] uppercase text-[10px] font-black">Ghairi</button>
                    </form>
                </div>

                <!-- Payment Modal -->
                <div id="pay-modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-[200] backdrop-blur-md">
                    <div class="bg-[#292524] p-12 rounded-[3rem] w-full max-w-md border border-[#44403c] space-y-10 text-center">
                        <h3 class="text-3xl font-black uppercase text-white">MALIPO</h3>
                        <div class="bg-[#1c1917] p-8 rounded-[2rem] border border-[#78350f]/20 space-y-4">
                           <p id="pay-plan-name" class="text-xs text-[#a8a29e] uppercase font-black"></p>
                           <p id="pay-plan-price" class="text-4xl font-black text-[#78350f] font-mono"></p>
                           <div class="pt-4 border-t border-[#44403c]">
                               <p class="text-[9px] text-[#44403c] uppercase font-black mb-1">Tuma fedha kwenda:</p>
                               <p class="text-xl font-bold text-white">${state.adminPhone}</p>
                               <p class="text-[10px] text-[#a8a29e]">${state.paymentName}</p>
                           </div>
                        </div>
                        <button onclick="submitPayment()" class="w-full py-6 btn-amber rounded-[2rem] font-black uppercase text-white flex items-center justify-center gap-3">TUMA OMBI <i data-lucide="message-square" class="w-5 h-5"></i></button>
                        <button onclick="document.getElementById('pay-modal').classList.add('hidden')" class="text-[#44403c] text-[10px] uppercase font-black">Ghairi Malipo</button>
                    </div>
                </div>
            `;
            document.body.appendChild(container);
        }

        // --- INITIALIZE ---
        window.onload = () => {
            render();
            if (state.isAdmin) updateAIInsight();
        };

        // Attach global functions to window for onclick handlers
        window.setView = setView;
        window.toggleAdmin = toggleAdmin;
        window.logout = logout;
    </script>
</body>
</html>
