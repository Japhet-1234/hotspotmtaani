<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIFI MTAANI | Hotspot</title>
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary-brown: #5d4037; 
            --accent-brown: #8d6e63;
            --bg-soft: #fcfaf9;
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-soft); 
            color: #4a3728; 
            margin: 0;
            padding: 0;
        }
        .text-brown { color: var(--primary-brown); }
        .bg-brown { background-color: var(--primary-brown); }
        .btn-brown { 
            background-color: var(--primary-brown); 
            color: white; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-brown:active { transform: scale(0.96); }
        
        .card-main { 
            background: white; 
            border-radius: 24px; 
            box-shadow: 0 10px 25px -5px rgba(93, 64, 55, 0.08);
            border: 1px solid rgba(93, 64, 55, 0.05);
            overflow: hidden;
        }
        
        .input-field {
            background-color: #fdfdfd;
            border: 1px solid #e7e0da;
            border-radius: 16px;
            padding: 14px;
            text-align: center;
            font-weight: 700;
            width: 100%;
            outline: none;
            color: var(--primary-brown);
            transition: all 0.2s;
        }
        .input-field:focus { border-color: var(--primary-brown); background-color: white; box-shadow: 0 0 0 4px rgba(93, 64, 55, 0.05); }

        .pkg-card {
            background: white;
            border-radius: 24px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(93, 64, 55, 0.04);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .pkg-card:hover { 
            transform: translateY(-8px); 
            border-color: var(--primary-brown); 
            box-shadow: 0 20px 40px -15px rgba(93, 64, 55, 0.2); 
        }
        .pkg-card:active { transform: scale(0.95); }

        #payment-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(46, 32, 27, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .hidden { display: none; }

        .instruction-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            padding: 12px;
            background: white;
            border-radius: 16px;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .step-num {
            width: 24px;
            height: 24px;
            background: var(--primary-brown);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 800;
            flex-shrink: 0;
        }

        .tab-btn { padding: 12px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; border-radius: 14px; flex: 1; transition: all 0.2s; }
        .tab-btn.active { background: var(--primary-brown); color: white; box-shadow: 0 4px 12px rgba(93, 64, 55, 0.2); }
        .tab-btn:not(.active) { color: #8d6e63; }

        .voucher-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .voucher-item { padding: 12px; background: #faf9f8; border-radius: 12px; border: 1px dashed #d7ccc8; text-align: center; font-size: 11px; font-weight: 800; cursor: pointer; color: var(--primary-brown); }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- MIKROTIK HIDDEN FORM -->
    <form name="sendin" action="$(link-login-only)" method="post" class="hidden">
        <input type="hidden" name="username" />
        <input type="hidden" name="password" />
        <input type="hidden" name="dst" value="$(link-orig)" />
    </form>

    <div id="app" class="max-w-md mx-auto p-6 space-y-10">
        
        <!-- HEADER -->
        <header class="text-center pt-8 space-y-4">
            <div class="inline-flex p-6 bg-white rounded-[2.5rem] shadow-md border border-orange-50/50">
                <i data-lucide="wifi" class="w-14 h-14 text-brown"></i>
            </div>
            <div class="space-y-1">
                <h1 class="text-4xl font-black tracking-tighter text-brown">WIFI MTAANI</h1>
                <p class="text-[12px] font-black text-slate-400 uppercase tracking-[0.5em]">Hotspot Management System</p>
            </div>
        </header>

        <!-- VIFURUSHI SECTION -->
        <section id="packages-section" class="space-y-10">
            <div class="grid grid-cols-2 gap-6">
                <div class="pkg-card" onclick="openPayment(200, 'Saa 1')">
                    <div class="p-4 bg-brown/5 rounded-2xl">
                        <i data-lucide="zap" class="w-7 h-7 text-brown"></i>
                    </div>
                    <p class="text-3xl font-black text-brown">200/=</p>
                    <p class="text-[12px] font-black text-slate-400 uppercase tracking-widest">Saa 1 Kamili</p>
                </div>
                <div class="pkg-card" onclick="openPayment(500, 'Masaa 6')">
                    <div class="p-4 bg-brown/5 rounded-2xl">
                        <i data-lucide="clock" class="w-7 h-7 text-brown"></i>
                    </div>
                    <p class="text-3xl font-black text-brown">500/=</p>
                    <p class="text-[12px] font-black text-slate-400 uppercase tracking-widest">Masaa 6</p>
                </div>
                <div class="pkg-card" onclick="openPayment(1000, 'Saa 24')">
                    <div class="p-4 bg-brown/5 rounded-2xl">
                        <i data-lucide="sun" class="w-7 h-7 text-brown"></i>
                    </div>
                    <p class="text-3xl font-black text-brown">1,000/=</p>
                    <p class="text-[12px] font-black text-slate-400 uppercase tracking-widest">Saa 24</p>
                </div>
                <div class="pkg-card" onclick="openPayment(2000, 'Siku 3')">
                    <div class="p-4 bg-brown/5 rounded-2xl">
                        <i data-lucide="calendar" class="w-7 h-7 text-brown"></i>
                    </div>
                    <p class="text-3xl font-black text-brown">2,000/=</p>
                    <p class="text-[12px] font-black text-slate-400 uppercase tracking-widest">Siku 3</p>
                </div>
            </div>

            <!-- MAELEKEZO CHINI YA VIFURUSHI -->
            <div class="space-y-6">
                <div class="flex items-center gap-3 justify-center">
                    <div class="h-[1px] bg-brown/10 flex-1"></div>
                    <h4 class="text-[10px] font-black text-brown/40 uppercase tracking-[0.3em]">Jinsi ya Kupata Vocha</h4>
                    <div class="h-[1px] bg-brown/10 flex-1"></div>
                </div>
                
                <div class="space-y-3">
                    <div class="instruction-item">
                        <span class="step-num">1</span>
                        <p class="text-[11px] font-semibold text-slate-500 leading-tight">Bofya kifurushi unachotaka hapo juu.</p>
                    </div>
                    <div class="instruction-item">
                        <span class="step-num">2</span>
                        <p class="text-[11px] font-semibold text-slate-500 leading-tight">Lipia kiasi husika kwenda <b>0779231924 (Japhet Sunday)</b>.</p>
                    </div>
                    <div class="instruction-item">
                        <span class="step-num">3</span>
                        <p class="text-[11px] font-semibold text-slate-500 leading-tight">Jaza jina na namba uliyolipa nayo kwenye fomu itakayotokea.</p>
                    </div>
                    <div class="instruction-item">
                        <span class="step-num">4</span>
                        <p class="text-[11px] font-semibold text-slate-500 leading-tight">Subiri SMS ya vocha yako. Ikifika, bofya "Weka Vocha" ili uingie.</p>
                    </div>
                </div>
            </div>

            <!-- OPTION TO JUST LOG IN -->
            <div class="pt-6 text-center">
                <button onclick="openVoucherEntry()" class="text-[11px] font-black text-brown/60 uppercase tracking-[0.2em] border-b-2 border-brown/10 pb-1 hover:text-brown transition-colors">
                    Tayari una vocha? Bonyeza hapa
                </button>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="text-center pt-6 opacity-40">
            <button onclick="showAdmin()" class="text-[9px] font-bold uppercase tracking-[0.2em] hover:text-brown transition-colors">Admin Access</button>
        </footer>
    </div>

    <!-- MAIN MODAL -->
    <div id="payment-modal">
        <div class="card-main w-full max-w-sm p-8 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="flex justify-between items-start">
                <div>
                    <h2 id="modal-title" class="text-2xl font-black text-brown uppercase leading-none">Huduma ya Vocha</h2>
                    <p id="modal-plan-name" class="text-[11px] font-bold text-slate-400 uppercase tracking-widest mt-2"></p>
                </div>
                <button onclick="closePayment()" class="p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
            </div>
            
            <div class="flex gap-2 p-1.5 bg-slate-100 rounded-2xl">
                <button id="tab-pay" onclick="switchTab('pay')" class="tab-btn active">Omba Vocha</button>
                <button id="tab-login" onclick="switchTab('login')" class="tab-btn">Weka Vocha</button>
            </div>

            <!-- SECTION PAY -->
            <div id="section-pay" class="space-y-6">
                <div class="bg-brown/5 border border-brown/10 p-6 rounded-2xl text-center space-y-1">
                    <p class="text-[10px] font-black text-brown uppercase opacity-60">Lipa kwa Tigo Pesa</p>
                    <p class="text-3xl font-black text-brown tracking-tighter">0779231924</p>
                    <p class="text-[11px] font-bold text-slate-400">Jina: Japhet Sunday</p>
                </div>
                <form onsubmit="submitRequest(event)" class="space-y-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">Jina lako la Malipo</label>
                        <input required id="req-name" type="text" placeholder="Mf: Anna Juma" class="input-field text-sm text-left px-5">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">Namba uliyolipa nayo</label>
                        <input required id="req-phone" type="tel" placeholder="07XXXXXXXX" class="input-field text-sm text-left px-5">
                    </div>
                    <button type="submit" class="btn-brown w-full py-5 rounded-2xl font-black text-[12px] uppercase tracking-widest shadow-xl">
                        TUMA MAOMBI YA VOCHA
                    </button>
                </form>
            </div>

            <!-- SECTION LOGIN -->
            <div id="section-login" class="hidden space-y-6">
                <div class="text-center py-4 bg-slate-50 rounded-2xl">
                    <p class="text-[12px] text-slate-500 font-medium px-4">Ingiza namba ya vocha hapa chini ili kuanza kutumia internet.</p>
                </div>
                <div class="space-y-5">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase text-center block tracking-widest">Namba ya Vocha</label>
                        <input id="login-vcode" type="text" placeholder="X X X X X X" class="input-field text-3xl tracking-[0.3em] uppercase">
                    </div>
                    <button onclick="handleLogin()" class="btn-brown w-full py-5 rounded-2xl font-black text-[12px] uppercase tracking-widest shadow-xl flex items-center justify-center gap-3">
                        UNGANISHA SASA <i data-lucide="zap" class="w-5 h-5 fill-current"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ADMIN MODAL -->
    <div id="admin-modal" class="hidden fixed inset-0 z-[100] bg-white p-6 overflow-y-auto space-y-6">
        <div class="flex justify-between items-center">
            <h2 class="text-xl font-black text-brown uppercase">Admin Portal</h2>
            <button onclick="hideAdmin()" class="p-2 bg-slate-100 rounded-xl"><i data-lucide="x" class="w-6 h-6 text-slate-400"></i></button>
        </div>
        <div id="admin-login-sec" class="card-main p-8 space-y-4">
            <input id="adm-pass" type="password" placeholder="Admin Passcode" class="input-field text-left px-5">
            <button onclick="verifyAdmin()" class="btn-brown w-full py-4 rounded-xl font-black uppercase tracking-widest">Ingia</button>
        </div>
        <div id="admin-dashboard" class="hidden space-y-6">
            <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                <button onclick="filterAdminVouchers('Saa 1')" class="px-5 py-3 bg-slate-100 rounded-2xl text-[10px] font-black uppercase text-brown">Saa 1</button>
                <button onclick="filterAdminVouchers('Masaa 6')" class="px-5 py-3 bg-slate-100 rounded-2xl text-[10px] font-black uppercase text-brown">Masaa 6</button>
                <button onclick="filterAdminVouchers('Saa 24')" class="px-5 py-3 bg-slate-100 rounded-2xl text-[10px] font-black uppercase text-brown">Saa 24</button>
                <button onclick="filterAdminVouchers('Siku 3')" class="px-5 py-3 bg-slate-100 rounded-2xl text-[10px] font-black uppercase text-brown">Siku 3</button>
            </div>
            <div class="card-main p-6">
                <h3 id="current-tab-name" class="text-xs font-black text-slate-400 uppercase mb-5 tracking-widest">Vocha</h3>
                <div id="voucher-list" class="voucher-grid"></div>
            </div>
        </div>
    </div>

    <!-- AI CHAT -->
    <div id="ai-chat-window" class="fixed bottom-6 right-6 z-50">
        <button onclick="toggleAiChat()" id="bot-btn" class="w-16 h-16 bg-brown text-white rounded-[1.8rem] shadow-2xl flex items-center justify-center hover:scale-105 active:scale-95 transition-all">
            <i data-lucide="bot" class="w-8 h-8"></i>
        </button>
        <div id="ai-chat-content" class="hidden absolute bottom-20 right-0 w-[320px] h-[450px] card-main overflow-hidden flex flex-col animate-in slide-in-from-bottom-5">
            <header class="bg-brown p-5 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Msaada wa AI</span>
                </div>
                <button onclick="toggleAiChat()"><i data-lucide="x" class="w-4 h-4"></i></button>
            </header>
            <div id="chat-messages" class="flex-1 p-5 overflow-y-auto space-y-4 bg-slate-50/50 text-[13px] font-medium leading-relaxed">
                <div class="bg-white p-4 rounded-2xl rounded-bl-none border border-slate-100 shadow-sm max-w-[90%]">Mambo! Mimi ni AI wa <b>WIFI MTAANI</b>. Una swali lolote?</div>
            </div>
            <div class="p-4 bg-white border-t border-slate-100 flex gap-2">
                <input id="ai-input" type="text" placeholder="Uliza swali..." class="flex-1 bg-slate-50 rounded-xl px-4 py-2.5 text-sm outline-none border border-transparent focus:border-brown/10" onkeypress="if(event.key==='Enter') sendToAi()">
                <button onclick="sendToAi()" class="p-3 bg-brown text-white rounded-xl active:scale-90"><i data-lucide="send" class="w-4 h-4"></i></button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        const VOUCHER_DB = {
            "Saa 1": ["1H-9921", "1H-1033", "1H-5500", "1H-2022"],
            "Masaa 6": ["6H-P821", "6H-Q992", "6H-R001"],
            "Saa 24": ["24H-PLAT", "24H-FAST"],
            "Siku 3": ["3D-ULTRA", "3D-MEGA"]
        };

        let currentSelected = { amt: 0, plan: "" };
        const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

        window.openPayment = (amt, plan) => {
            currentSelected = { amt, plan };
            document.getElementById('modal-title').innerText = "Huduma ya Vocha";
            document.getElementById('modal-plan-name').innerText = `${plan} â€¢ TSH ${amt}/=`;
            window.switchTab('pay');
            document.getElementById('payment-modal').style.display = 'flex';
        };

        window.openVoucherEntry = () => {
            document.getElementById('modal-title').innerText = "Ingia Mtandaoni";
            document.getElementById('modal-plan-name').innerText = "Ingiza vocha uliyopewa hapa";
            window.switchTab('login');
            document.getElementById('payment-modal').style.display = 'flex';
        };

        window.closePayment = () => {
            document.getElementById('payment-modal').style.display = 'none';
        };

        window.switchTab = (tab) => {
            const paySec = document.getElementById('section-pay');
            const loginSec = document.getElementById('section-login');
            const payTab = document.getElementById('tab-pay');
            const loginTab = document.getElementById('tab-login');
            if(tab === 'pay') {
                paySec.classList.remove('hidden'); loginSec.classList.add('hidden');
                payTab.classList.add('active'); loginTab.classList.remove('active');
            } else {
                paySec.classList.add('hidden'); loginSec.classList.remove('hidden');
                payTab.classList.remove('active'); loginTab.classList.add('active');
            }
        };

        window.submitRequest = (e) => {
            e.preventDefault();
            const name = document.getElementById('req-name').value;
            const phone = document.getElementById('req-phone').value;
            const msg = `Habari Japhet, nimefanya malipo ya ${currentSelected.amt} kwa ${currentSelected.plan}. Jina: ${name}, Namba: ${phone}. Nitumie vocha.`;
            alert("Maombi yako yametumwa! Utapata vocha hivi punde kwa SMS.");
            window.location.href = `sms:0779231924?body=${encodeURIComponent(msg)}`;
            window.closePayment();
        };

        window.handleLogin = () => {
            const vcode = document.getElementById('login-vcode').value.trim();
            if(!vcode) return alert("Ingiza namba ya vocha!");
            document.sendin.username.value = vcode;
            document.sendin.password.value = vcode;
            alert(`Inajaribu kuunganisha...`);
            setTimeout(() => { document.sendin.submit(); }, 1500);
        };

        window.showAdmin = () => document.getElementById('admin-modal').classList.remove('hidden');
        window.hideAdmin = () => document.getElementById('admin-modal').classList.add('hidden');
        
        window.verifyAdmin = () => {
            const pass = document.getElementById('adm-pass').value;
            if(pass === "mtaani") {
                document.getElementById('admin-login-sec').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                window.filterAdminVouchers('Saa 1');
            } else { alert("Passcode imekataa!"); }
        };

        window.filterAdminVouchers = (plan) => {
            document.getElementById('current-tab-name').innerText = `Vocha: ${plan}`;
            const list = document.getElementById('voucher-list');
            list.innerHTML = '';
            (VOUCHER_DB[plan] || []).forEach(v => {
                const div = document.createElement('div');
                div.className = 'voucher-item';
                div.innerText = v;
                div.onclick = () => {
                    navigator.clipboard.writeText(v);
                    const old = div.innerText; div.innerText = "YAKO!";
                    setTimeout(() => div.innerText = old, 1000);
                };
                list.appendChild(div);
            });
        };

        window.toggleAiChat = () => {
            document.getElementById('ai-chat-content').classList.toggle('hidden');
        };

        window.sendToAi = async () => {
            const input = document.getElementById('ai-input');
            const msg = input.value.trim();
            if(!msg) return;
            const container = document.getElementById('chat-messages');
            const userDiv = document.createElement('div');
            userDiv.className = 'bg-brown text-white p-4 rounded-2xl rounded-br-none self-end max-w-[90%] ml-auto';
            userDiv.innerText = msg;
            container.appendChild(userDiv);
            input.value = '';
            container.scrollTop = container.scrollHeight;
            try {
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: msg,
                    config: {
                        systemInstruction: "Wewe ni msaidizi wa WIFI MTAANI. Bosi ni Japhet (0779231924). Bei: 200, 500, 1000. Mteja bofya kifurushi kulipia."
                    }
                });
                const aiDiv = document.createElement('div');
                aiDiv.className = 'bg-white p-4 rounded-2xl rounded-bl-none border border-slate-100 max-w-[90%]';
                aiDiv.innerText = response.text;
                container.appendChild(aiDiv);
                container.scrollTop = container.scrollHeight;
            } catch(e) { console.error(e); }
        };

        lucide.createIcons();
    </script>
</body>
</html>